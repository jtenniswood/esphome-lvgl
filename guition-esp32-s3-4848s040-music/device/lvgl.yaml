# =============================================================================
# LVGL MUSIC DASHBOARD
# =============================================================================
# Now-playing view with dynamic media player switching.
# Swipe down on the main page to open the entity picker.
# Data from sensors.yaml; album art from online_image (addon/music.yaml).
# Entity picker logic in addon/entity_picker.yaml.
# =============================================================================

lvgl:
  buffer_size: 100%

  pages:
    # =========================================================================
    # MAIN PAGE — now-playing view
    # =========================================================================
    # Full 480px content width (no horizontal padding) so progress bar can span edge-to-edge.
    # Top padding 12px, no bottom padding (progress bar flush to bottom edge).
    # Text/buttons use 12px horizontal inset via x/width.
    - id: main_page
      scrollbar_mode: "off"
      scrollable: false
      width: 100%
      height: 100%
      bg_color: 0x1E1E1E
      pad_top: 12
      pad_bottom: 0
      pad_left: 0
      pad_right: 0
      on_swipe_down:
        - lvgl.page.show:
            id: entity_picker_page
            animation: MOVE_BOTTOM
            time: 300ms

      widgets:
        # Full-screen artwork background (negative offsets cancel page padding)
        - image:
            id: album_art_background_widget
            x: 0
            y: -12
            width: 480px
            height: 480px
            src: album_art_background
            opa: 100%

        # Active speaker name + swipe hint at top of screen
        - label:
            id: active_speaker_label
            text: "—"
            x: 12
            y: 0
            width: 420px
            height: 20px
            long_mode: dot
            text_font: roboto15_font
            text_color: 0xFFFFFF
            opa: 70%
            text_align: left

        - label:
            id: swipe_hint_icon
            text: $chevron_down
            x: 440
            y: -4
            width: 40px
            text_font: $icon_font
            text_color: 0xFFFFFF
            opa: 30%
            text_align: center

        # Song title + artist sit on the same row as the control buttons (left side)
        - label:
            id: media_title_label
            text: "—"
            x: 12
            y: 352
            width: 284px
            height: 30px
            long_mode: dot
            text_font: roboto30_font
            text_color: 0xFFFFFF
            text_align: left

        - label:
            id: media_artist_label
            text: "—"
            x: 12
            y: 392
            width: 284px
            text_font: roboto19_font
            text_color: 0xD0D0D0
            text_align: left

        # Control buttons: 72px round; play/pause + next aligned to the right
        # Play/pause: two icon labels; visibility toggled by sensors.yaml from state
        - button:
            id: media_play_pause_button
            x: 396
            y: 344
            width: 72px
            height: 72px
            styles: control_round
            widgets:
              - label:
                  id: media_play_icon
                  text_font: $icon_font
                  align: center
                  text: $play
                  text_color: 0xFFFFFF
                  hidden: false
              - label:
                  id: media_pause_icon
                  text_font: $icon_font
                  align: center
                  text: $pause
                  text_color: 0xFFFFFF
                  hidden: true
            on_press:
              - homeassistant.service:
                  service: media_player.media_play_pause
                  data_template:
                    entity_id: "{{ entity_id }}"
                  variables:
                    entity_id: !lambda 'return id(active_media_player_sensor).state;'

        - button:
            id: media_next_button
            x: 396
            y: 344
            width: 72px
            height: 72px
            hidden: true
            styles: control_round
            widgets:
              - label:
                  text_font: $icon_font
                  align: center
                  text: $skip_next
                  text_color: 0xFFFFFF
            on_press:
              - homeassistant.service:
                  service: media_player.media_next_track
                  data_template:
                    entity_id: "{{ entity_id }}"
                  variables:
                    entity_id: !lambda 'return id(active_media_player_sensor).state;'

        - button:
            id: media_previous_button
            x: 396
            y: 344
            width: 72px
            height: 72px
            hidden: true
            styles: control_round
            widgets:
              - label:
                  text_font: $icon_font
                  align: center
                  text: $skip_previous
                  text_color: 0xFFFFFF
            on_press:
              - homeassistant.service:
                  service: media_player.media_previous_track
                  data_template:
                    entity_id: "{{ entity_id }}"
                  variables:
                    entity_id: !lambda 'return id(active_media_player_sensor).state;'

        # TV mode: centered source label, shown only when source is "TV"
        - label:
            id: tv_source_label
            text: "TV"
            align: center
            text_font: roboto30_font
            text_color: 0xFFFFFF
            hidden: true

        # Play clocks: elapsed (left) and duration (right), below buttons and above progress bar
        - label:
            id: media_elapsed_label
            text: "0:00"
            x: 12
            y: 440
            width: 40px
            text_font: roboto15_font
            text_color: 0xFFFFFF

        - label:
            id: media_duration_label
            text: "0:00"
            x: 428
            y: 440
            width: 40px
            text_font: roboto15_font
            text_color: 0xFFFFFF
            text_align: right

        # Progress bar: full screen width, at the very bottom of the screen
        - bar:
            id: media_progress_bar
            x: 0
            y: 464
            width: 480
            height: 4
            bg_color: 0x000000
            bg_opa: 50%
            radius: 0
            min_value: 0
            max_value: 100
            value: 0
            indicator:
              bg_color: 0xFFFFFF
              radius: 0

    # =========================================================================
    # ENTITY PICKER PAGE — swipe down to reveal, select a media player
    # =========================================================================
    - id: entity_picker_page
      scrollbar_mode: "off"
      scrollable: false
      width: 100%
      height: 100%
      bg_color: 0x1E1E1E
      pad_all: 0
      on_swipe_up:
        - lvgl.page.show:
            id: main_page
            animation: MOVE_TOP
            time: 300ms

      widgets:
        - label:
            text: "Select Speaker"
            x: 0
            y: 30
            width: 480px
            text_font: roboto30_font
            text_color: 0xFFFFFF
            text_align: center

        # Roller populated dynamically from HA sensor.media_players_list
        # Tapping an item immediately switches the active entity and returns.
        - roller:
            id: entity_roller
            y: 90
            x: 20
            width: 440px
            height: 320px
            options: "Loading..."
            mode: normal
            visible_row_count: 5
            selected:
              text_color: 0xFFFFFF
              bg_color: 0xFF8C00
              bg_opa: 100%
            items:
              text_color: 0x909090
            text_font: roboto19_font
            on_click:
              - script.execute: entity_picker_select

        # Subtle hint at bottom
        - label:
            text: "Swipe up to go back"
            x: 0
            y: 440
            width: 480px
            text_font: roboto15_font
            text_color: 0x606060
            text_align: center
